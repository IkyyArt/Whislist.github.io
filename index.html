<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Wishlist & Tabungan - Kelola Impian dan Keuangan</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #6c5ce7;
        --secondary: #a29bfe;
        --accent: #fd79a8;
        --light: #f8f9fa;
        --dark: #2d3436;
        --success: #00b894;
        --warning: #fdcb6e;
        --danger: #e74c3c;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: var(--dark);
        overflow-x: hidden;
      }

      /* Navbar Mobile Friendly */
      .navbar {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        padding: 1rem 0;
      }

      .navbar-brand {
        font-weight: 700;
        color: var(--primary) !important;
        font-size: 1.2rem;
      }

      .navbar-toggler {
        border: none;
        padding: 0.25rem 0.5rem;
      }

      .navbar-toggler:focus {
        box-shadow: none;
      }

      /* Hero Section Mobile */
      .hero-section {
        background: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--secondary) 100%
        );
        color: white;
        padding: 3rem 0;
        border-radius: 0 0 30px 30px;
        position: relative;
        overflow: hidden;
      }

      .hero-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.1" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
        background-size: cover;
        background-position: center;
      }

      .hero-title {
        font-weight: 800;
        margin-bottom: 1rem;
        font-size: 2rem;
      }

      .hero-subtitle {
        font-size: 1rem;
        margin-bottom: 1.5rem;
        opacity: 0.9;
      }

      /* Stats Section Mobile */
      .stats-section {
        margin-top: -2rem;
        position: relative;
        z-index: 10;
      }

      .stats-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        text-align: center;
        transition: all 0.3s ease;
        height: 100%;
        margin-bottom: 1rem;
      }

      .stats-number {
        font-size: 2rem;
        font-weight: 800;
        color: var(--primary);
        margin-bottom: 0.5rem;
        line-height: 1;
      }

      .stats-label {
        color: #6c757d;
        font-weight: 500;
        font-size: 0.9rem;
      }

      /* Savings Section Mobile */
      .savings-card {
        background: linear-gradient(135deg, var(--success), #00a085);
        color: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 10px 30px rgba(0, 184, 148, 0.3);
        transition: all 0.3s ease;
        margin-bottom: 1.5rem;
      }

      .savings-amount {
        font-size: 2rem;
        font-weight: 800;
        margin-bottom: 1rem;
      }

      .budget-summary {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        height: 100%;
      }

      /* Main Content Mobile */
      .main-content {
        padding: 3rem 0;
      }

      .section-title {
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: var(--dark);
        font-size: 1.5rem;
      }

      /* Tabs Mobile */
      .nav-tabs {
        border-bottom: 2px solid #e9ecef;
        margin-bottom: 1.5rem;
        flex-wrap: nowrap;
        overflow-x: auto;
        white-space: nowrap;
      }

      .nav-tabs .nav-link {
        border: none;
        color: #6c757d;
        font-weight: 600;
        padding: 0.75rem 1rem;
        border-radius: 10px 10px 0 0;
        transition: all 0.3s;
        font-size: 0.9rem;
        min-width: auto;
      }

      .nav-tabs .nav-link.active {
        background: var(--primary);
        color: white;
      }

      /* Wishlist Cards Mobile */
      .wishlist-card {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        margin-bottom: 1.5rem;
        border: 1px solid #f1f3f4;
      }

      .wishlist-header {
        padding: 1.25rem;
        background: rgba(108, 92, 231, 0.05);
        cursor: pointer;
        transition: background 0.3s;
      }

      .wishlist-title {
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 0.25rem;
        font-size: 1.1rem;
      }

      .wishlist-meta {
        color: #6c757d;
        font-size: 0.8rem;
      }

      .wishlist-price {
        font-weight: 700;
        color: var(--primary);
        font-size: 1rem;
      }

      .wishlist-content {
        padding: 1.25rem;
      }

      /* Progress Bars Mobile */
      .progress {
        height: 8px;
        border-radius: 10px;
        margin: 0.75rem 0;
        background: #e9ecef;
      }

      .progress-bar {
        border-radius: 10px;
        transition: width 0.5s ease;
      }

      /* Buttons Mobile */
      .btn {
        border-radius: 50px;
        padding: 0.6rem 1.25rem;
        font-weight: 600;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        min-height: 44px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .btn-primary {
        background: var(--primary);
        border: none;
      }

      .btn-primary:hover {
        background: var(--secondary);
        transform: translateY(-2px);
      }

      .btn-success {
        background: var(--success);
        border: none;
      }

      .btn-light {
        background: white;
        border: none;
        color: var(--dark);
      }

      .btn-sm {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
        min-height: 36px;
      }

      /* Floating Button Mobile */
      .floating-btn {
        position: fixed;
        bottom: 1.5rem;
        right: 1.5rem;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: var(--accent);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        box-shadow: 0 5px 20px rgba(253, 121, 168, 0.5);
        z-index: 1000;
        transition: all 0.3s ease;
        animation: pulse 2s infinite;
      }

      .floating-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 8px 25px rgba(253, 121, 168, 0.7);
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 5px 20px rgba(253, 121, 168, 0.5);
        }
        50% {
          box-shadow: 0 5px 30px rgba(253, 121, 168, 0.8);
        }
        100% {
          box-shadow: 0 5px 20px rgba(253, 121, 168, 0.5);
        }
      }

      /* Empty State Mobile */
      .empty-state {
        text-align: center;
        padding: 2.5rem 1rem;
        color: #6c757d;
      }

      .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: #dee2e6;
      }

      .empty-state h3 {
        margin-bottom: 0.75rem;
        color: #6c757d;
        font-size: 1.25rem;
      }

      /* Modal Mobile */
      .modal-content {
        border-radius: 15px;
        border: none;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
      }

      .modal-header {
        padding: 1.25rem;
      }

      .modal-body {
        padding: 1.25rem;
      }

      .modal-footer {
        padding: 1rem 1.25rem;
      }

      /* Form Controls Mobile */
      .form-control,
      .form-select {
        border-radius: 10px;
        padding: 0.75rem;
        border: 1px solid #e0e0e0;
        transition: all 0.3s ease;
        font-size: 1rem;
      }

      .form-control:focus,
      .form-select:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 0.25rem rgba(108, 92, 231, 0.25);
      }

      /* Image Upload Mobile */
      .image-upload-container {
        border: 2px dashed #ddd;
        border-radius: 10px;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        margin-bottom: 1rem;
      }

      .image-upload-container:hover {
        border-color: var(--primary);
        background: rgba(108, 92, 231, 0.05);
      }

      .image-preview {
        max-width: 100%;
        max-height: 200px;
        border-radius: 10px;
        margin: 0.75rem auto;
        display: block;
        border: 2px solid var(--secondary);
      }

      .item-image {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 8px;
        margin-right: 0.75rem;
        border: 2px solid var(--secondary);
        cursor: pointer;
      }

      .item-image-placeholder {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, var(--secondary), var(--primary));
        border-radius: 8px;
        margin-right: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.25rem;
        border: 2px dashed var(--secondary);
      }

      /* Photo Gallery Mobile */
      .photo-gallery {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.75rem;
      }

      .photo-thumbnail {
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
      }

      .photo-thumbnail:hover {
        transform: scale(1.1);
        border-color: var(--primary);
      }

      /* Category Gallery */
      .category-gallery {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.75rem;
      }

      .category-photo-thumbnail {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
      }

      .category-photo-thumbnail:hover {
        transform: scale(1.1);
        border-color: var(--primary);
      }

      /* Modal galeri kategori */
      .gallery-modal .carousel-item img {
        max-height: 70vh;
        object-fit: contain;
        margin: 0 auto;
      }

      .gallery-modal .carousel-control-prev,
      .gallery-modal .carousel-control-next {
        width: 5%;
        opacity: 0.8;
      }

      .gallery-modal .carousel-indicators {
        bottom: -50px;
      }

      .gallery-modal .carousel-indicators button {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin: 0 5px;
      }

      /* Transaction History Mobile */
      .transaction-history {
        max-height: 300px;
        overflow-y: auto;
      }

      .transaction-item {
        padding: 0.75rem;
        border-bottom: 1px solid #e9ecef;
        transition: all 0.3s ease;
      }

      .transaction-item:hover {
        background: #f8f9fa;
      }

      /* Footer Mobile */
      footer {
        background: var(--dark);
        color: white;
        padding: 2rem 0;
        margin-top: 3rem;
      }

      /* Custom Swipe Gallery Styles */
      .swipe-gallery {
        position: relative;
        width: 100%;
        height: 70vh;
        overflow: hidden;
        border-radius: 10px;
      }

      .swipe-gallery-container {
        display: flex;
        width: 100%;
        height: 100%;
        transition: transform 0.3s ease;
      }

      .swipe-gallery-slide {
        flex: 0 0 100%;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .swipe-gallery-slide img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
      }

      .swipe-gallery-indicators {
        position: absolute;
        bottom: 20px;
        left: 0;
        right: 0;
        display: flex;
        justify-content: center;
        gap: 8px;
        z-index: 10;
      }

      .swipe-gallery-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.5);
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .swipe-gallery-indicator.active {
        background-color: white;
        transform: scale(1.2);
      }

      .swipe-gallery-nav {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 10;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .swipe-gallery:hover .swipe-gallery-nav {
        opacity: 1;
      }

      .swipe-gallery-nav.prev {
        left: 0;
      }

      .swipe-gallery-nav.next {
        right: 0;
      }

      .swipe-gallery-nav-icon {
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
      }

      /* PERBAIKAN: Style untuk tombol hapus foto kategori */
      .photo-delete-btn {
        position: absolute;
        top: -5px;
        right: -5px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--danger);
        color: white;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        z-index: 20;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }

      .photo-delete-btn:hover {
        background: #c0392b;
        transform: scale(1.1);
      }

      .photo-container {
        position: relative;
        display: inline-block;
      }

      /* PERBAIKAN: Style untuk drag & drop foto */
      .photo-container.dragging {
        opacity: 0.5;
        transform: scale(0.95);
      }

      .photo-container.drag-over {
        border: 2px dashed var(--primary);
        border-radius: 8px;
        background-color: rgba(108, 92, 231, 0.1);
      }

      .category-gallery {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.75rem;
        min-height: 80px;
      }

      .photo-container {
        position: relative;
        display: inline-block;
        transition: all 0.3s ease;
        cursor: grab;
      }

      .photo-container:active {
        cursor: grabbing;
      }

      /* Mobile-specific improvements */
      @media (max-width: 576px) {
        .container {
          padding-left: 15px;
          padding-right: 15px;
        }

        .hero-title {
          font-size: 1.75rem;
        }

        .hero-subtitle {
          font-size: 0.9rem;
        }

        .stats-number {
          font-size: 1.75rem;
        }

        .savings-amount {
          font-size: 1.75rem;
        }

        .section-title {
          font-size: 1.25rem;
        }

        .wishlist-title {
          font-size: 1rem;
        }

        .btn {
          width: 100%;
          margin-bottom: 0.5rem;
        }

        .btn-group .btn {
          width: auto;
          margin-bottom: 0;
        }

        .d-flex.justify-content-between {
          flex-direction: column;
        }

        .d-flex.justify-content-between > * {
          margin-bottom: 0.75rem;
        }

        .d-flex.justify-content-between > *:last-child {
          margin-bottom: 0;
        }

        .swipe-gallery {
          height: 50vh;
        }

        .swipe-gallery-nav {
          opacity: 1;
          width: 40px;
        }

        .swipe-gallery-nav-icon {
          width: 35px;
          height: 35px;
          font-size: 14px;
        }
      }

      /* Animation */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .fade-in {
        animation: fadeIn 0.5s ease forwards;
      }

      /* Badge styles */
      .badge {
        font-size: 0.7rem;
        padding: 0.25rem 0.5rem;
      }

      /* Confetti */
      .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        background-color: var(--primary);
        top: -10px;
        border-radius: 50%;
        animation: confetti-fall 5s linear forwards;
        z-index: 10000;
      }

      @keyframes confetti-fall {
        0% {
          transform: translateY(0) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(100vh) rotate(360deg);
          opacity: 0;
        }
      }

      /* Cover Photo Indicator */
      .cover-badge {
        position: absolute;
        top: 0;
        left: 0;
        background: var(--success);
        color: white;
        font-size: 0.6rem;
        padding: 2px 4px;
        border-radius: 4px 0 4px 0;
        z-index: 1;
      }

      .photo-container {
        position: relative;
        display: inline-block;
      }

      /* Category Photo Management */
      .category-photo-management {
        margin-top: 1rem;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 10px;
      }

      .category-photo-management h6 {
        margin-bottom: 0.75rem;
        color: var(--dark);
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
      <div class="container">
        <a class="navbar-brand" href="#">
          <i class="fas fa-piggy-bank me-2"></i>Wishlist & Tabungan
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link active" href="#">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#wishlists">Wishlist Saya</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#budget">Tabungan</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
      <div class="container text-center position-relative">
        <h1 class="hero-title">Wishlist & Tabungan Terpusat</h1>
        <p class="hero-subtitle">
          Kelola wishlist dan tabunganmu di satu tempat dengan mudah
        </p>
        <button
          class="btn btn-light btn-lg"
          data-bs-toggle="modal"
          data-bs-target="#addWishlistModal"
        >
          <i class="fas fa-plus me-2"></i>Buat Wishlist Baru
        </button>
      </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section">
      <div class="container">
        <div class="row g-3">
          <div class="col-4">
            <div class="stats-card fade-in">
              <div class="stats-number" id="totalWishlists">0</div>
              <div class="stats-label">Wishlist</div>
            </div>
          </div>
          <div class="col-4">
            <div class="stats-card fade-in" style="animation-delay: 0.1s">
              <div class="stats-number" id="totalCategories">0</div>
              <div class="stats-label">Kategori</div>
            </div>
          </div>
          <div class="col-4">
            <div class="stats-card fade-in" style="animation-delay: 0.2s">
              <div class="stats-number" id="totalItems">0</div>
              <div class="stats-label">Item</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Savings Section -->
    <section class="main-content" id="savings">
      <div class="container">
        <h2 class="section-title">Tabungan & Budget</h2>
        <div class="row g-3">
          <div class="col-12">
            <div class="savings-card">
              <div class="row align-items-center">
                <div class="col-12 col-md-6 mb-3 mb-md-0">
                  <h3 class="mb-2">Tabungan Saat Ini</h3>
                  <div class="savings-amount" id="currentSavings">Rp 0</div>
                  <p class="mb-0">Tabungan untuk semua wishlist</p>
                </div>
                <div class="col-12 col-md-6 text-md-end">
                  <div class="d-grid d-md-block gap-2">
                    <button
                      class="btn btn-light me-md-2 mb-2 mb-md-0"
                      data-bs-toggle="modal"
                      data-bs-target="#addSavingsModal"
                    >
                      <i class="fas fa-plus me-2"></i>Tambah
                    </button>
                    <button
                      class="btn btn-light"
                      data-bs-toggle="modal"
                      data-bs-target="#withdrawSavingsModal"
                    >
                      <i class="fas fa-minus me-2"></i>Kurangi
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12">
            <div class="budget-summary">
              <h4 class="mb-3">Ringkasan Budget</h4>
              <div class="d-flex justify-content-between mb-2">
                <span>Total Dibutuhkan:</span>
                <strong id="summaryNeeded">Rp 0</strong>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>Tabungan Saat Ini:</span>
                <strong id="summarySavings">Rp 0</strong>
              </div>
              <div class="d-flex justify-content-between mb-3">
                <span>Kekurangan:</span>
                <strong id="summaryRemaining">Rp 0</strong>
              </div>
              <div class="progress mb-2">
                <div
                  class="progress-bar bg-success"
                  role="progressbar"
                  id="summaryProgress"
                  style="width: 0%"
                ></div>
              </div>
              <small class="text-muted" id="summaryPercentage"
                >0% tercapai</small
              >
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Content -->
    <section class="main-content" id="wishlists">
      <div class="container">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="wishlists-tab"
              data-bs-toggle="tab"
              data-bs-target="#wishlists-content"
              type="button"
              role="tab"
            >
              <i class="fas fa-th-list me-2"></i>Wishlist
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="transactions-tab"
              data-bs-toggle="tab"
              data-bs-target="#transactions-content"
              type="button"
              role="tab"
            >
              <i class="fas fa-history me-2"></i>Transaksi
            </button>
          </li>
        </ul>

        <div class="tab-content" id="myTabContent">
          <!-- Wishlists Tab -->
          <div
            class="tab-pane fade show active"
            id="wishlists-content"
            role="tabpanel"
          >
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2 class="section-title mb-0">Daftar Wishlist Saya</h2>
              <div class="dropdown">
                <button
                  class="btn btn-outline-primary btn-sm dropdown-toggle"
                  type="button"
                  data-bs-toggle="dropdown"
                >
                  <i class="fas fa-filter me-1"></i>Filter
                </button>
                <ul class="dropdown-menu">
                  <li>
                    <a
                      class="dropdown-item filter-option"
                      data-filter="all"
                      href="#"
                      >Semua</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item filter-option"
                      data-filter="completed"
                      href="#"
                      >Selesai</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item filter-option"
                      data-filter="in-progress"
                      href="#"
                      >Dalam Proses</a
                    >
                  </li>
                </ul>
              </div>
            </div>

            <div id="wishlistsContainer">
              <!-- Wishlist items will be dynamically added here -->
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state">
              <i class="fas fa-layer-group"></i>
              <h3>Belum Ada Wishlist</h3>
              <p>
                Mulai buat wishlist impianmu dengan struktur hierarki yang
                lengkap!
              </p>
              <button
                class="btn btn-primary mt-3"
                data-bs-toggle="modal"
                data-bs-target="#addWishlistModal"
              >
                <i class="fas fa-plus me-2"></i>Buat Wishlist Pertama
              </button>
            </div>
          </div>

          <!-- Transactions Tab -->
          <div class="tab-pane fade" id="transactions-content" role="tabpanel">
            <h2 class="section-title">Riwayat Transaksi Tabungan</h2>

            <div class="card border-0 shadow-sm">
              <div class="card-body p-0">
                <div class="transaction-history" id="transactionHistory">
                  <!-- Transaction items will be dynamically added here -->
                </div>

                <div id="emptyTransactionState" class="empty-state py-4">
                  <i class="fas fa-history"></i>
                  <h5>Belum Ada Transaksi</h5>
                  <p>
                    Mulai tambahkan atau kurangi tabungan untuk melihat riwayat
                    transaksi!
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer>
      <div class="container text-center">
        <p>
          &copy; 2023 Wishlist & Tabungan App. Kelola impian dan keuanganmu
          dengan mudah!
        </p>
      </div>
    </footer>

    <!-- Floating Action Button -->
    <div
      class="floating-btn"
      data-bs-toggle="modal"
      data-bs-target="#addWishlistModal"
    >
      <i class="fas fa-plus"></i>
    </div>

    <!-- Add Wishlist Modal -->
    <div class="modal fade" id="addWishlistModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Buat Wishlist Baru</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addWishlistForm">
              <div class="mb-3">
                <label for="wishlistName" class="form-label"
                  >Nama Wishlist</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="wishlistName"
                  placeholder="Contoh: Blooket Transformers"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="wishlistDescription" class="form-label"
                  >Deskripsi (Opsional)</label
                >
                <textarea
                  class="form-control"
                  id="wishlistDescription"
                  rows="3"
                  placeholder="Deskripsi tentang wishlist ini..."
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button type="button" class="btn btn-primary" id="saveWishlistBtn">
              Simpan Wishlist
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Category Modal -->
    <div class="modal fade" id="addCategoryModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Tambah Kategori</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addCategoryForm">
              <input type="hidden" id="categoryWishlistId" />
              <div class="mb-3">
                <label for="categoryName" class="form-label"
                  >Nama Kategori</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="categoryName"
                  placeholder="Contoh: Blooket 1"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="categoryDescription" class="form-label"
                  >Deskripsi (Opsional)</label
                >
                <textarea
                  class="form-control"
                  id="categoryDescription"
                  rows="3"
                  placeholder="Deskripsi tentang kategori ini..."
                ></textarea>
              </div>
              <!-- Upload Foto Kategori -->
              <div class="mb-3">
                <label class="form-label">Foto Kategori (Opsional)</label>
                <div
                  class="image-upload-container"
                  id="categoryImageUploadContainer"
                >
                  <i class="fas fa-cloud-upload-alt fa-2x mb-3 text-muted"></i>
                  <p class="mb-2">Klik atau drag & drop untuk upload foto</p>
                  <small class="text-muted"
                    >Format: JPG, PNG, GIF (Max 2MB)</small
                  >
                  <input
                    type="file"
                    id="categoryImage"
                    accept="image/*"
                    class="d-none"
                  />
                </div>
                <div id="categoryImagePreview" class="text-center"></div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button type="button" class="btn btn-primary" id="saveCategoryBtn">
              Simpan Kategori
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Item Modal -->
    <div class="modal fade" id="addItemModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Tambah Item</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addItemForm">
              <input type="hidden" id="itemWishlistId" />
              <input type="hidden" id="itemCategoryId" />
              <div class="mb-3">
                <label for="itemName" class="form-label">Nama Item</label>
                <input
                  type="text"
                  class="form-control"
                  id="itemName"
                  placeholder="Contoh: Optimus Prime"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="itemPrice" class="form-label">Harga (Rp)</label>
                <input
                  type="number"
                  class="form-control"
                  id="itemPrice"
                  min="1"
                  required
                />
              </div>

              <!-- Upload Foto Item -->
              <div class="mb-3">
                <label class="form-label">Foto Item (Opsional)</label>
                <div class="image-upload-container" id="imageUploadContainer">
                  <i class="fas fa-cloud-upload-alt fa-2x mb-3 text-muted"></i>
                  <p class="mb-2">Klik atau drag & drop untuk upload foto</p>
                  <small class="text-muted"
                    >Format: JPG, PNG, GIF (Max 2MB)</small
                  >
                  <input
                    type="file"
                    id="itemImage"
                    accept="image/*"
                    class="d-none"
                  />
                </div>
                <div id="imagePreview" class="text-center"></div>
              </div>

              <div class="mb-3">
                <label for="itemTiktokLink" class="form-label"
                  >Link TikTok (Opsional)</label
                >
                <input
                  type="url"
                  class="form-control"
                  id="itemTiktokLink"
                  placeholder="https://www.tiktok.com/..."
                />
              </div>
              <div class="mb-3">
                <label for="itemShopeeLink" class="form-label"
                  >Link Shopee (Opsional)</label
                >
                <input
                  type="url"
                  class="form-control"
                  id="itemShopeeLink"
                  placeholder="https://shopee.co.id/..."
                />
              </div>
              <div class="mb-3">
                <label for="itemDescription" class="form-label"
                  >Deskripsi (Opsional)</label
                >
                <textarea
                  class="form-control"
                  id="itemDescription"
                  rows="3"
                  placeholder="Deskripsi tentang item ini..."
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button type="button" class="btn btn-primary" id="saveItemBtn">
              Simpan Item
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Savings Modal -->
    <div class="modal fade" id="addSavingsModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Tambah Tabungan</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addSavingsForm">
              <div class="mb-3">
                <label for="savingsAmount" class="form-label"
                  >Jumlah Tabungan (Rp)</label
                >
                <input
                  type="number"
                  class="form-control"
                  id="savingsAmount"
                  min="1"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="savingsDescription" class="form-label"
                  >Keterangan (Opsional)</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="savingsDescription"
                  placeholder="Contoh: Gaji bulanan, Hadiah, dll"
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button type="button" class="btn btn-success" id="saveSavingsBtn">
              Tambah Tabungan
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Withdraw Savings Modal -->
    <div class="modal fade" id="withdrawSavingsModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Kurangi Tabungan</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="withdrawSavingsForm">
              <div class="mb-3">
                <label for="withdrawAmount" class="form-label"
                  >Jumlah Penarikan (Rp)</label
                >
                <input
                  type="number"
                  class="form-control"
                  id="withdrawAmount"
                  min="1"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="withdrawDescription" class="form-label"
                  >Keterangan (Opsional)</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="withdrawDescription"
                  placeholder="Contoh: Keperluan mendadak, Beli kebutuhan, dll"
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button type="button" class="btn btn-warning" id="saveWithdrawBtn">
              Kurangi Tabungan
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-body text-center p-5">
            <i
              class="fas fa-check-circle text-success mb-3"
              style="font-size: 4rem"
            ></i>
            <h3 class="mb-3">Berhasil!</h3>
            <p id="successMessage">Wishlist berhasil ditambahkan!</p>
            <button
              type="button"
              class="btn btn-primary mt-3"
              data-bs-dismiss="modal"
            >
              Tutup
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Photo Modal -->
    <div class="modal fade photo-modal" id="photoModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Foto Item</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <img id="modalPhoto" src="" alt="Foto Item" class="img-fluid" />
          </div>
        </div>
      </div>
    </div>

    <!-- Category Gallery Modal -->
    <div
      class="modal fade gallery-modal"
      id="categoryGalleryModal"
      tabindex="-1"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Galeri Foto Kategori</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div
              id="categoryCarousel"
              class="carousel slide"
              data-bs-ride="carousel"
            >
              <div class="carousel-indicators" id="categoryCarouselIndicators">
                <!-- Indicators akan diisi secara dinamis -->
              </div>
              <div class="carousel-inner" id="categoryCarouselInner">
                <!-- Items akan diisi secara dinamis -->
              </div>
              <button
                class="carousel-control-prev"
                type="button"
                data-bs-target="#categoryCarousel"
                data-bs-slide="prev"
              >
                <span
                  class="carousel-control-prev-icon"
                  aria-hidden="true"
                ></span>
                <span class="visually-hidden">Previous</span>
              </button>
              <button
                class="carousel-control-next"
                type="button"
                data-bs-target="#categoryCarousel"
                data-bs-slide="next"
              >
                <span
                  class="carousel-control-next-icon"
                  aria-hidden="true"
                ></span>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Category Photo Management Modal -->
    <div class="modal fade" id="categoryPhotoManagementModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Kelola Foto Kategori</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="category-photo-management">
              <h6>Foto Kategori</h6>
              <div class="mb-3">
                <button
                  class="btn btn-primary btn-sm"
                  onclick="uploadCategoryPhotos()"
                >
                  <i class="fas fa-plus me-1"></i>Tambah Foto
                </button>
              </div>
              <div id="categoryPhotosContainer" class="category-gallery">
                <!-- Foto kategori akan ditampilkan di sini -->
              </div>
              <div class="mt-3">
                <small class="text-muted"
                  >Foto pertama akan menjadi foto cover. Drag & drop untuk
                  mengubah urutan foto.</small
                >
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Tutup
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Custom Swipe Gallery Modal -->
    <div class="modal fade" id="swipeGalleryModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Galeri Foto</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body p-0">
            <div class="swipe-gallery" id="swipeGallery">
              <div class="swipe-gallery-container" id="swipeGalleryContainer">
                <!-- Slides will be added dynamically -->
              </div>
              <div class="swipe-gallery-indicators" id="swipeGalleryIndicators">
                <!-- Indicators will be added dynamically -->
              </div>
              <div class="swipe-gallery-nav prev" onclick="swipeGalleryPrev()">
                <div class="swipe-gallery-nav-icon">
                  <i class="fas fa-chevron-left"></i>
                </div>
              </div>
              <div class="swipe-gallery-nav next" onclick="swipeGalleryNext()">
                <div class="swipe-gallery-nav-icon">
                  <i class="fas fa-chevron-right"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Data storage
      let wishlists = JSON.parse(localStorage.getItem("wishlists")) || [];
      let savings = parseInt(localStorage.getItem("savings")) || 0;
      let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
      let currentCategoryForPhotoManagement = null;
      let currentSwipeGalleryData = null;

      // DOM Elements
      const wishlistsContainer = document.getElementById("wishlistsContainer");
      const emptyState = document.getElementById("emptyState");
      const emptyTransactionState = document.getElementById(
        "emptyTransactionState"
      );
      const transactionHistory = document.getElementById("transactionHistory");
      const addWishlistForm = document.getElementById("addWishlistForm");
      const saveWishlistBtn = document.getElementById("saveWishlistBtn");
      const addCategoryForm = document.getElementById("addCategoryForm");
      const saveCategoryBtn = document.getElementById("saveCategoryBtn");
      const addItemForm = document.getElementById("addItemForm");
      const saveItemBtn = document.getElementById("saveItemBtn");
      const addSavingsForm = document.getElementById("addSavingsForm");
      const saveSavingsBtn = document.getElementById("saveSavingsBtn");
      const withdrawSavingsForm = document.getElementById(
        "withdrawSavingsForm"
      );
      const saveWithdrawBtn = document.getElementById("saveWithdrawBtn");
      const totalWishlistsEl = document.getElementById("totalWishlists");
      const totalCategoriesEl = document.getElementById("totalCategories");
      const totalItemsEl = document.getElementById("totalItems");
      const currentSavingsEl = document.getElementById("currentSavings");
      const summaryNeededEl = document.getElementById("summaryNeeded");
      const summarySavingsEl = document.getElementById("summarySavings");
      const summaryRemainingEl = document.getElementById("summaryRemaining");
      const summaryProgressEl = document.getElementById("summaryProgress");
      const summaryPercentageEl = document.getElementById("summaryPercentage");
      const categoryPhotosContainer = document.getElementById(
        "categoryPhotosContainer"
      );

      // Image upload elements
      const imageUploadContainer = document.getElementById(
        "imageUploadContainer"
      );
      const itemImageInput = document.getElementById("itemImage");
      const imagePreview = document.getElementById("imagePreview");

      // Category image upload elements
      const categoryImageUploadContainer = document.getElementById(
        "categoryImageUploadContainer"
      );
      const categoryImageInput = document.getElementById("categoryImage");
      const categoryImagePreview = document.getElementById(
        "categoryImagePreview"
      );

      // Swipe gallery elements
      const swipeGalleryContainer = document.getElementById(
        "swipeGalleryContainer"
      );
      const swipeGalleryIndicators = document.getElementById(
        "swipeGalleryIndicators"
      );

      // Drag and drop variables
      let draggedItem = null;

      // Initialize the app
      document.addEventListener("DOMContentLoaded", function () {
        renderWishlists();
        updateStats();
        updateSavingsDisplay();
        renderTransactions();
        setupEventListeners();
        setupImageUpload();
        setupCategoryImageUpload();
        setupSwipeGallery();
      });

      // Setup event listeners
      function setupEventListeners() {
        // Save wishlist button
        saveWishlistBtn.addEventListener("click", addWishlist);

        // Save category button
        saveCategoryBtn.addEventListener("click", addCategory);

        // Save item button
        saveItemBtn.addEventListener("click", addItem);

        // Save savings button
        saveSavingsBtn.addEventListener("click", addSavings);

        // Save withdraw button
        saveWithdrawBtn.addEventListener("click", withdrawSavings);

        // Filter options
        document.querySelectorAll(".filter-option").forEach((option) => {
          option.addEventListener("click", function (e) {
            e.preventDefault();
            const filter = this.getAttribute("data-filter");
            filterWishlists(filter);
          });
        });
      }

      // Setup image upload functionality
      function setupImageUpload() {
        // Click to upload
        imageUploadContainer.addEventListener("click", function () {
          itemImageInput.click();
        });

        // File selection
        itemImageInput.addEventListener("change", function (e) {
          handleImageUpload(e.target.files[0]);
        });

        // Drag and drop
        imageUploadContainer.addEventListener("dragover", function (e) {
          e.preventDefault();
          this.classList.add("dragover");
        });

        imageUploadContainer.addEventListener("dragleave", function (e) {
          e.preventDefault();
          this.classList.remove("dragover");
        });

        imageUploadContainer.addEventListener("drop", function (e) {
          e.preventDefault();
          this.classList.remove("dragover");
          if (e.dataTransfer.files.length) {
            handleImageUpload(e.dataTransfer.files[0]);
          }
        });
      }

      // Setup category image upload functionality
      function setupCategoryImageUpload() {
        // Click to upload
        categoryImageUploadContainer.addEventListener("click", function () {
          categoryImageInput.click();
        });

        // File selection
        categoryImageInput.addEventListener("change", function (e) {
          handleCategoryImageUpload(e.target.files[0]);
        });

        // Drag and drop
        categoryImageUploadContainer.addEventListener("dragover", function (e) {
          e.preventDefault();
          this.classList.add("dragover");
        });

        categoryImageUploadContainer.addEventListener(
          "dragleave",
          function (e) {
            e.preventDefault();
            this.classList.remove("dragover");
          }
        );

        categoryImageUploadContainer.addEventListener("drop", function (e) {
          e.preventDefault();
          this.classList.remove("dragover");
          if (e.dataTransfer.files.length) {
            handleCategoryImageUpload(e.dataTransfer.files[0]);
          }
        });
      }

      // Setup swipe gallery functionality
      function setupSwipeGallery() {
        const swipeGallery = document.getElementById("swipeGallery");
        let startX = 0;
        let endX = 0;

        swipeGallery.addEventListener("touchstart", (e) => {
          startX = e.touches[0].clientX;
        });

        swipeGallery.addEventListener("touchmove", (e) => {
          endX = e.touches[0].clientX;
        });

        swipeGallery.addEventListener("touchend", () => {
          const diff = startX - endX;
          const minSwipeDistance = 50;

          if (Math.abs(diff) > minSwipeDistance) {
            if (diff > 0) {
              // Swipe left - next photo
              swipeGalleryNext();
            } else {
              // Swipe right - previous photo
              swipeGalleryPrev();
            }
          }
        });
      }

      // Handle image upload
      function handleImageUpload(file) {
        if (!file || !file.type.startsWith("image/")) {
          alert("Silakan pilih file gambar yang valid!");
          return;
        }

        if (file.size > 2 * 1024 * 1024) {
          alert("Ukuran file maksimal 2MB!");
          return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
          imagePreview.innerHTML = `
                    <img src="${e.target.result}" class="image-preview" alt="Preview">
                    <button type="button" class="btn btn-sm btn-danger mt-2" onclick="clearImagePreview()">
                        <i class="fas fa-times me-1"></i>Hapus Foto
                    </button>
                `;
        };
        reader.readAsDataURL(file);
      }

      // Handle category image upload
      function handleCategoryImageUpload(file) {
        if (!file || !file.type.startsWith("image/")) {
          alert("Silakan pilih file gambar yang valid!");
          return;
        }

        if (file.size > 2 * 1024 * 1024) {
          alert("Ukuran file maksimal 2MB!");
          return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
          categoryImagePreview.innerHTML = `
                    <img src="${e.target.result}" class="image-preview" alt="Preview">
                    <button type="button" class="btn btn-sm btn-danger mt-2" onclick="clearCategoryImagePreview()">
                        <i class="fas fa-times me-1"></i>Hapus Foto
                    </button>
                `;
        };
        reader.readAsDataURL(file);
      }

      // Clear image preview
      function clearImagePreview() {
        imagePreview.innerHTML = "";
        itemImageInput.value = "";
      }

      // Clear category image preview
      function clearCategoryImagePreview() {
        categoryImagePreview.innerHTML = "";
        categoryImageInput.value = "";
      }

      // Add a new wishlist
      function addWishlist() {
        const name = document.getElementById("wishlistName").value;
        const description = document.getElementById(
          "wishlistDescription"
        ).value;

        if (!name) {
          alert("Nama wishlist harus diisi!");
          return;
        }

        const newWishlist = {
          id: Date.now(),
          name,
          description,
          categories: [],
          createdAt: new Date().toISOString(),
        };

        wishlists.push(newWishlist);
        saveToLocalStorage();
        renderWishlists();
        updateStats();

        // Show success message
        document.getElementById("successMessage").textContent =
          "Wishlist berhasil ditambahkan!";
        const successModal = new bootstrap.Modal(
          document.getElementById("successModal")
        );
        successModal.show();

        // Reset form
        addWishlistForm.reset();
        const addWishlistModal = bootstrap.Modal.getInstance(
          document.getElementById("addWishlistModal")
        );
        addWishlistModal.hide();

        // Add confetti animation
        createConfetti();
      }

      // Add a category to a wishlist
      function addCategory() {
        const wishlistId = parseInt(
          document.getElementById("categoryWishlistId").value
        );
        const name = document.getElementById("categoryName").value;
        const description = document.getElementById(
          "categoryDescription"
        ).value;

        if (!wishlistId || !name) {
          alert("Nama kategori harus diisi!");
          return;
        }

        const wishlist = wishlists.find((w) => w.id === wishlistId);
        if (!wishlist) return;

        // Get image data if available
        let imageData = null;
        const previewImg = categoryImagePreview.querySelector("img");
        if (previewImg) {
          imageData = previewImg.src;
        }

        const newCategory = {
          id: Date.now(),
          name,
          description,
          image: imageData,
          items: [],
          photos: imageData ? [imageData] : [], // Array untuk foto-foto kategori
        };

        wishlist.categories.push(newCategory);
        saveToLocalStorage();
        renderWishlists();
        updateStats();

        // Show success message
        document.getElementById("successMessage").textContent =
          "Kategori berhasil ditambahkan!";
        const successModal = new bootstrap.Modal(
          document.getElementById("successModal")
        );
        successModal.show();

        // Reset form
        addCategoryForm.reset();
        clearCategoryImagePreview();
        const addCategoryModal = bootstrap.Modal.getInstance(
          document.getElementById("addCategoryModal")
        );
        addCategoryModal.hide();
      }

      // Add an item to a category
      function addItem() {
        const wishlistId = parseInt(
          document.getElementById("itemWishlistId").value
        );
        const categoryId = parseInt(
          document.getElementById("itemCategoryId").value
        );
        const name = document.getElementById("itemName").value;
        const price = parseInt(document.getElementById("itemPrice").value);
        const tiktokLink = document.getElementById("itemTiktokLink").value;
        const shopeeLink = document.getElementById("itemShopeeLink").value;
        const description = document.getElementById("itemDescription").value;

        if (!wishlistId || !categoryId || !name || !price) {
          alert("Nama dan harga item harus diisi!");
          return;
        }

        const wishlist = wishlists.find((w) => w.id === wishlistId);
        if (!wishlist) return;

        const category = wishlist.categories.find((c) => c.id === categoryId);
        if (!category) return;

        // Get image data if available
        let imageData = null;
        const previewImg = imagePreview.querySelector("img");
        if (previewImg) {
          imageData = previewImg.src;
        }

        const newItem = {
          id: Date.now(),
          name,
          price,
          image: imageData,
          tiktokLink,
          shopeeLink,
          description,
          achieved: false,
        };

        category.items.push(newItem);
        saveToLocalStorage();
        renderWishlists();
        updateStats();

        // Show success message
        document.getElementById("successMessage").textContent =
          "Item berhasil ditambahkan!";
        const successModal = new bootstrap.Modal(
          document.getElementById("successModal")
        );
        successModal.show();

        // Reset form
        addItemForm.reset();
        clearImagePreview();
        const addItemModal = bootstrap.Modal.getInstance(
          document.getElementById("addItemModal")
        );
        addItemModal.hide();
      }

      // Add savings
      function addSavings() {
        const amount = parseInt(document.getElementById("savingsAmount").value);
        const description = document.getElementById("savingsDescription").value;

        if (!amount || amount <= 0) {
          alert("Jumlah tabungan harus diisi dengan angka positif!");
          return;
        }

        savings += amount;

        // Add transaction
        const transaction = {
          id: Date.now(),
          type: "deposit",
          amount,
          description: description || "Tabungan",
          date: new Date().toISOString(),
        };

        transactions.unshift(transaction);

        saveToLocalStorage();
        updateSavingsDisplay();
        renderTransactions();

        // Show success message
        document.getElementById(
          "successMessage"
        ).textContent = `Tabungan berhasil ditambahkan sebesar Rp ${amount.toLocaleString(
          "id-ID"
        )}!`;
        const successModal = new bootstrap.Modal(
          document.getElementById("successModal")
        );
        successModal.show();

        // Reset form
        addSavingsForm.reset();
        const addSavingsModal = bootstrap.Modal.getInstance(
          document.getElementById("addSavingsModal")
        );
        addSavingsModal.hide();

        // Add confetti animation for large deposits
        if (amount >= 100000) {
          createConfetti();
        }
      }

      // Withdraw savings
      function withdrawSavings() {
        const amount = parseInt(
          document.getElementById("withdrawAmount").value
        );
        const description = document.getElementById(
          "withdrawDescription"
        ).value;

        if (!amount || amount <= 0) {
          alert("Jumlah penarikan harus diisi dengan angka positif!");
          return;
        }

        if (amount > savings) {
          alert("Jumlah penarikan melebihi tabungan yang tersedia!");
          return;
        }

        savings -= amount;

        // Add transaction
        const transaction = {
          id: Date.now(),
          type: "withdrawal",
          amount,
          description: description || "Penarikan",
          date: new Date().toISOString(),
        };

        transactions.unshift(transaction);

        saveToLocalStorage();
        updateSavingsDisplay();
        renderTransactions();

        // Show success message
        document.getElementById(
          "successMessage"
        ).textContent = `Tabungan berhasil dikurangi sebesar Rp ${amount.toLocaleString(
          "id-ID"
        )}!`;
        const successModal = new bootstrap.Modal(
          document.getElementById("successModal")
        );
        successModal.show();

        // Reset form
        withdrawSavingsForm.reset();
        const withdrawSavingsModal = bootstrap.Modal.getInstance(
          document.getElementById("withdrawSavingsModal")
        );
        withdrawSavingsModal.hide();
      }

      // Delete a wishlist
      function deleteWishlist(id) {
        if (confirm("Apakah Anda yakin ingin menghapus wishlist ini?")) {
          wishlists = wishlists.filter((w) => w.id !== id);
          saveToLocalStorage();
          renderWishlists();
          updateStats();
        }
      }

      // Delete a category
      function deleteCategory(wishlistId, categoryId) {
        if (confirm("Apakah Anda yakin ingin menghapus kategori ini?")) {
          const wishlist = wishlists.find((w) => w.id === wishlistId);
          if (wishlist) {
            wishlist.categories = wishlist.categories.filter(
              (c) => c.id !== categoryId
            );
            saveToLocalStorage();
            renderWishlists();
            updateStats();
          }
        }
      }

      // Delete an item
      function deleteItem(wishlistId, categoryId, itemId) {
        if (confirm("Apakah Anda yakin ingin menghapus item ini?")) {
          const wishlist = wishlists.find((w) => w.id === wishlistId);
          if (wishlist) {
            const category = wishlist.categories.find(
              (c) => c.id === categoryId
            );
            if (category) {
              category.items = category.items.filter((i) => i.id !== itemId);
              saveToLocalStorage();
              renderWishlists();
              updateStats();
            }
          }
        }
      }

      // Toggle categories visibility
      function toggleCategories(wishlistId) {
        const categoriesContainer = document.getElementById(
          `categories-${wishlistId}`
        );
        const toggleIcon = document.getElementById(`toggle-icon-${wishlistId}`);

        if (categoriesContainer.style.display === "none") {
          categoriesContainer.style.display = "block";
          toggleIcon.className = "fas fa-chevron-up";
        } else {
          categoriesContainer.style.display = "none";
          toggleIcon.className = "fas fa-chevron-down";
        }
      }

      // Toggle items visibility
      function toggleItems(categoryId) {
        const itemsContainer = document.getElementById(`items-${categoryId}`);
        const toggleIcon = document.getElementById(
          `item-toggle-icon-${categoryId}`
        );

        if (itemsContainer.style.display === "none") {
          itemsContainer.style.display = "block";
          toggleIcon.className = "fas fa-chevron-up";
        } else {
          itemsContainer.style.display = "none";
          toggleIcon.className = "fas fa-chevron-down";
        }
      }

      // Edit wishlist name
      function editWishlistName(wishlistId) {
        const wishlist = wishlists.find((w) => w.id === wishlistId);
        if (!wishlist) return;

        const titleElement = document.getElementById(
          `wishlist-title-${wishlistId}`
        );
        const currentName = wishlist.name;

        titleElement.innerHTML = `
                <input type="text" class="form-control" value="${currentName}" id="edit-wishlist-${wishlistId}">
                <div class="mt-2">
                    <button class="btn btn-sm btn-success me-2" onclick="saveWishlistName(${wishlistId})">
                        <i class="fas fa-check me-1"></i>Simpan
                    </button>
                    <button class="btn btn-sm btn-secondary" onclick="cancelEditWishlistName(${wishlistId}, '${currentName}')">
                        <i class="fas fa-times me-1"></i>Batal
                    </button>
                </div>
            `;

        document.getElementById(`edit-wishlist-${wishlistId}`).focus();
      }

      // Save wishlist name
      function saveWishlistName(wishlistId) {
        const wishlist = wishlists.find((w) => w.id === wishlistId);
        if (!wishlist) return;

        const newName = document.getElementById(
          `edit-wishlist-${wishlistId}`
        ).value;
        if (!newName.trim()) {
          alert("Nama wishlist tidak boleh kosong!");
          return;
        }

        wishlist.name = newName;
        saveToLocalStorage();
        renderWishlists();
      }

      // Cancel edit wishlist name
      function cancelEditWishlistName(wishlistId, originalName) {
        const titleElement = document.getElementById(
          `wishlist-title-${wishlistId}`
        );
        titleElement.innerHTML = `
                ${originalName}
                <button class="btn btn-sm btn-outline-primary ms-2" onclick="editWishlistName(${wishlistId})">
                    <i class="fas fa-edit"></i>
                </button>
            `;
      }

      // Edit category name
      function editCategoryName(wishlistId, categoryId) {
        const wishlist = wishlists.find((w) => w.id === wishlistId);
        if (!wishlist) return;

        const category = wishlist.categories.find((c) => c.id === categoryId);
        if (!category) return;

        const titleElement = document.getElementById(
          `category-title-${categoryId}`
        );
        const currentName = category.name;

        titleElement.innerHTML = `
                <input type="text" class="form-control" value="${currentName}" id="edit-category-${categoryId}">
                <div class="mt-2">
                    <button class="btn btn-sm btn-success me-2" onclick="saveCategoryName(${wishlistId}, ${categoryId})">
                        <i class="fas fa-check me-1"></i>Simpan
                    </button>
                    <button class="btn btn-sm btn-secondary" onclick="cancelEditCategoryName(${wishlistId}, ${categoryId}, '${currentName}')">
                        <i class="fas fa-times me-1"></i>Batal
                    </button>
                </div>
            `;

        document.getElementById(`edit-category-${categoryId}`).focus();
      }

      // Save category name
      function saveCategoryName(wishlistId, categoryId) {
        const wishlist = wishlists.find((w) => w.id === wishlistId);
        if (!wishlist) return;

        const category = wishlist.categories.find((c) => c.id === categoryId);
        if (!category) return;

        const newName = document.getElementById(
          `edit-category-${categoryId}`
        ).value;
        if (!newName.trim()) {
          alert("Nama kategori tidak boleh kosong!");
          return;
        }

        category.name = newName;
        saveToLocalStorage();
        renderWishlists();
      }

      // Cancel edit category name
      function cancelEditCategoryName(wishlistId, categoryId, originalName) {
        const titleElement = document.getElementById(
          `category-title-${categoryId}`
        );
        titleElement.innerHTML = `
                ${originalName}
                <button class="btn btn-sm btn-outline-primary ms-2" onclick="editCategoryName(${wishlistId}, ${categoryId})">
                    <i class="fas fa-edit"></i>
                </button>
            `;
      }

      // Open category photo management modal
      function openCategoryPhotoManagement(wishlistId, categoryId) {
        currentCategoryForPhotoManagement = { wishlistId, categoryId };
        renderCategoryPhotos();
        const modal = new bootstrap.Modal(
          document.getElementById("categoryPhotoManagementModal")
        );
        modal.show();
      }

      // PERBAIKAN: Render category photos in management modal dengan drag & drop yang berfungsi
      function renderCategoryPhotos() {
        if (!currentCategoryForPhotoManagement) return;

        const { wishlistId, categoryId } = currentCategoryForPhotoManagement;
        const wishlist = wishlists.find((w) => w.id === wishlistId);
        const category = wishlist.categories.find((c) => c.id === categoryId);

        if (!category) return;

        categoryPhotosContainer.innerHTML = "";

        if (category.photos && category.photos.length > 0) {
          category.photos.forEach((photo, index) => {
            const photoContainer = document.createElement("div");
            photoContainer.className = "photo-container";
            photoContainer.draggable = true;
            photoContainer.setAttribute("data-index", index);

            // PERBAIKAN: Struktur HTML yang lebih baik dengan event.stopPropagation()
            photoContainer.innerHTML = `
                        <div class="position-relative">
                            <img src="${photo}" class="category-photo-thumbnail" alt="Foto kategori ${
              index + 1
            }">
                            ${
                              index === 0
                                ? '<span class="cover-badge">Cover</span>'
                                : ""
                            }
                            <button class="photo-delete-btn" 
                                    onclick="event.stopPropagation(); deleteCategoryPhoto(${index})">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;

            // PERBAIKAN: Setup drag and drop functionality dengan event listener yang benar
            setupDragAndDrop(photoContainer);

            categoryPhotosContainer.appendChild(photoContainer);
          });
        } else {
          categoryPhotosContainer.innerHTML = `
                    <div class="text-center text-muted py-3">
                        <i class="fas fa-images fa-2x mb-2"></i>
                        <p>Belum ada foto untuk kategori ini</p>
                    </div>
                `;
        }
      }

      // PERBAIKAN: Setup drag and drop functionality
      function setupDragAndDrop(element) {
        element.addEventListener("dragstart", handleDragStart);
        element.addEventListener("dragover", handleDragOver);
        element.addEventListener("dragenter", handleDragEnter);
        element.addEventListener("dragleave", handleDragLeave);
        element.addEventListener("drop", handleDrop);
        element.addEventListener("dragend", handleDragEnd);
      }

      // PERBAIKAN: Drag and drop handlers untuk foto reordering
      function handleDragStart(e) {
        draggedItem = this;
        e.dataTransfer.effectAllowed = "move";
        e.dataTransfer.setData("text/plain", this.getAttribute("data-index"));
        this.classList.add("dragging");

        // Tambahkan delay kecil untuk memastikan drag dimulai
        setTimeout(() => {
          this.style.opacity = "0.4";
        }, 0);
      }

      function handleDragOver(e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = "move";
        return false;
      }

      function handleDragEnter(e) {
        e.preventDefault();
        this.classList.add("drag-over");
      }

      function handleDragLeave(e) {
        this.classList.remove("drag-over");
      }

      function handleDrop(e) {
        e.preventDefault();
        e.stopPropagation();

        if (draggedItem !== this) {
          const fromIndex = parseInt(draggedItem.getAttribute("data-index"));
          const toIndex = parseInt(this.getAttribute("data-index"));

          reorderCategoryPhotos(fromIndex, toIndex);
        }

        this.classList.remove("drag-over");
        return false;
      }

      function handleDragEnd() {
        this.classList.remove("dragging");
        this.style.opacity = "1";

        // Hapus class drag-over dari semua elemen
        document.querySelectorAll(".photo-container").forEach((item) => {
          item.classList.remove("drag-over");
        });
      }

      // PERBAIKAN: Reorder category photos
      function reorderCategoryPhotos(fromIndex, toIndex) {
        if (!currentCategoryForPhotoManagement) return;

        const { wishlistId, categoryId } = currentCategoryForPhotoManagement;
        const wishlist = wishlists.find((w) => w.id === wishlistId);
        const category = wishlist.categories.find((c) => c.id === categoryId);

        if (!category || !category.photos) return;

        // Simpan foto yang akan dipindah
        const movedPhoto = category.photos[fromIndex];

        // Hapus foto dari posisi asal
        category.photos.splice(fromIndex, 1);

        // Sisipkan foto ke posisi tujuan
        category.photos.splice(toIndex, 0, movedPhoto);

        saveToLocalStorage();
        renderCategoryPhotos();
        renderWishlists(); // Update the main view to reflect changes

        // Tampilkan pesan sukses
        document.getElementById("successMessage").textContent =
          "Urutan foto berhasil diubah!";
        const successModal = new bootstrap.Modal(
          document.getElementById("successModal")
        );
        successModal.show();
      }

      // Upload category photos
      function uploadCategoryPhotos() {
        const input = document.createElement("input");
        input.type = "file";
        input.accept = "image/*";
        input.multiple = true;
        input.onchange = function (e) {
          const files = e.target.files;
          if (!files || files.length === 0) return;

          let uploadedCount = 0;

          for (let i = 0; i < files.length; i++) {
            const file = files[i];
            if (!file.type.startsWith("image/")) {
              alert("Silakan pilih file gambar yang valid!");
              continue;
            }

            if (file.size > 2 * 1024 * 1024) {
              alert("Ukuran file maksimal 2MB!");
              continue;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
              const { wishlistId, categoryId } =
                currentCategoryForPhotoManagement;
              const wishlist = wishlists.find((w) => w.id === wishlistId);
              const category = wishlist.categories.find(
                (c) => c.id === categoryId
              );

              if (!category.photos) {
                category.photos = [];
              }

              category.photos.push(e.target.result);
              uploadedCount++;

              // Jika semua file telah diproses, simpan dan render ulang
              if (uploadedCount === files.length) {
                saveToLocalStorage();
                renderCategoryPhotos();
                renderWishlists();

                // Show success message
                document.getElementById(
                  "successMessage"
                ).textContent = `${uploadedCount} foto berhasil ditambahkan ke kategori!`;
                const successModal = new bootstrap.Modal(
                  document.getElementById("successModal")
                );
                successModal.show();
              }
            };
            reader.readAsDataURL(file);
          }
        };
        input.click();
      }

      // Delete photo dari kategori
      function deleteCategoryPhoto(photoIndex) {
        if (confirm("Apakah Anda yakin ingin menghapus foto ini?")) {
          if (!currentCategoryForPhotoManagement) return;

          const { wishlistId, categoryId } = currentCategoryForPhotoManagement;
          const wishlist = wishlists.find((w) => w.id === wishlistId);
          const category = wishlist.categories.find((c) => c.id === categoryId);

          if (category && category.photos) {
            category.photos.splice(photoIndex, 1);
            saveToLocalStorage();
            renderCategoryPhotos();
            renderWishlists();
          }
        }
      }

      // View category photo gallery
      function viewCategoryGallery(wishlistId, categoryId, startIndex = 0) {
        const wishlist = wishlists.find((w) => w.id === wishlistId);
        const category = wishlist.categories.find((c) => c.id === categoryId);

        if (!category || !category.photos || category.photos.length === 0) {
          return;
        }

        const carouselInner = document.getElementById("categoryCarouselInner");
        const carouselIndicators = document.getElementById(
          "categoryCarouselIndicators"
        );

        // Kosongkan konten sebelumnya
        carouselInner.innerHTML = "";
        carouselIndicators.innerHTML = "";

        // Tambahkan foto ke carousel
        category.photos.forEach((photo, index) => {
          const isActive = index === startIndex;

          // Tambahkan indicator
          const indicator = document.createElement("button");
          indicator.type = "button";
          indicator.setAttribute("data-bs-target", "#categoryCarousel");
          indicator.setAttribute("data-bs-slide-to", index);
          indicator.className = isActive ? "active" : "";
          indicator.setAttribute("aria-current", isActive ? "true" : "false");
          indicator.setAttribute("aria-label", `Slide ${index + 1}`);
          carouselIndicators.appendChild(indicator);

          // Tambahkan item carousel
          const carouselItem = document.createElement("div");
          carouselItem.className = `carousel-item ${isActive ? "active" : ""}`;
          carouselItem.innerHTML = `
                    <img src="${photo}" class="d-block w-100" alt="Foto kategori ${
            index + 1
          }">
                `;
          carouselInner.appendChild(carouselItem);
        });

        // Tampilkan modal
        const galleryModal = new bootstrap.Modal(
          document.getElementById("categoryGalleryModal")
        );
        galleryModal.show();
      }

      // Open swipe gallery modal
      function openSwipeGallery(photos, startIndex = 0) {
        currentSwipeGalleryData = {
          photos: photos,
          currentIndex: startIndex,
        };

        renderSwipeGallery();
        const modal = new bootstrap.Modal(
          document.getElementById("swipeGalleryModal")
        );
        modal.show();
      }

      // Render swipe gallery
      function renderSwipeGallery() {
        if (!currentSwipeGalleryData) return;

        const { photos, currentIndex } = currentSwipeGalleryData;

        // Clear previous content
        swipeGalleryContainer.innerHTML = "";
        swipeGalleryIndicators.innerHTML = "";

        // Add slides
        photos.forEach((photo, index) => {
          const slide = document.createElement("div");
          slide.className = "swipe-gallery-slide";
          slide.innerHTML = `<img src="${photo}" alt="Foto ${index + 1}">`;
          swipeGalleryContainer.appendChild(slide);

          // Add indicator
          const indicator = document.createElement("div");
          indicator.className = `swipe-gallery-indicator ${
            index === currentIndex ? "active" : ""
          }`;
          indicator.setAttribute("data-index", index);
          indicator.onclick = () => goToSlide(index);
          swipeGalleryIndicators.appendChild(indicator);
        });

        // Update position
        updateSwipeGalleryPosition();
      }

      // Update swipe gallery position
      function updateSwipeGalleryPosition() {
        if (!currentSwipeGalleryData) return;
        swipeGalleryContainer.style.transform = `translateX(-${
          currentSwipeGalleryData.currentIndex * 100
        }%)`;
      }

      // Go to specific slide
      function goToSlide(index) {
        if (!currentSwipeGalleryData) return;
        currentSwipeGalleryData.currentIndex = index;
        updateSwipeGalleryPosition();
        updateSwipeGalleryIndicators();
      }

      // Update swipe gallery indicators
      function updateSwipeGalleryIndicators() {
        if (!currentSwipeGalleryData) return;
        const indicators = document.querySelectorAll(
          ".swipe-gallery-indicator"
        );
        indicators.forEach((indicator, index) => {
          if (index === currentSwipeGalleryData.currentIndex) {
            indicator.classList.add("active");
          } else {
            indicator.classList.remove("active");
          }
        });
      }

      // Swipe gallery next
      function swipeGalleryNext() {
        if (!currentSwipeGalleryData) return;
        const nextIndex =
          (currentSwipeGalleryData.currentIndex + 1) %
          currentSwipeGalleryData.photos.length;
        goToSlide(nextIndex);
      }

      // Swipe gallery previous
      function swipeGalleryPrev() {
        if (!currentSwipeGalleryData) return;
        const prevIndex =
          currentSwipeGalleryData.currentIndex === 0
            ? currentSwipeGalleryData.photos.length - 1
            : currentSwipeGalleryData.currentIndex - 1;
        goToSlide(prevIndex);
      }

      // Edit item
      function editItem(wishlistId, categoryId, itemId) {
        const wishlist = wishlists.find((w) => w.id === wishlistId);
        if (!wishlist) return;

        const category = wishlist.categories.find((c) => c.id === categoryId);
        if (!category) return;

        const item = category.items.find((i) => i.id === itemId);
        if (!item) return;

        const itemElement = document.getElementById(`item-${itemId}`);

        itemElement.innerHTML = `
                <div class="edit-item-form">
                    <div class="mb-3">
                        <label class="form-label">Nama Item</label>
                        <input type="text" class="form-control" id="edit-item-name-${itemId}" value="${
          item.name
        }" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Harga (Rp)</label>
                        <input type="number" class="form-control" id="edit-item-price-${itemId}" value="${
          item.price
        }" min="1" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Foto Item</label>
                        <div class="image-upload-container" onclick="document.getElementById('edit-item-image-${itemId}').click()">
                            <i class="fas fa-cloud-upload-alt fa-2x mb-3 text-muted"></i>
                            <p class="mb-2">Klik untuk ganti foto</p>
                            <input type="file" id="edit-item-image-${itemId}" accept="image/*" class="d-none" onchange="handleEditImageUpload(${wishlistId}, ${categoryId}, ${itemId}, this.files[0])" />
                        </div>
                        ${
                          item.image
                            ? `<img src="${item.image}" class="image-preview mt-2" alt="Current Image">`
                            : ""
                        }
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Link TikTok</label>
                        <input type="url" class="form-control" id="edit-item-tiktok-${itemId}" value="${
          item.tiktokLink || ""
        }" placeholder="https://www.tiktok.com/...">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Link Shopee</label>
                        <input type="url" class="form-control" id="edit-item-shopee-${itemId}" value="${
          item.shopeeLink || ""
        }" placeholder="https://shopee.co.id/...">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Deskripsi</label>
                        <textarea class="form-control" id="edit-item-description-${itemId}" rows="2">${
          item.description || ""
        }</textarea>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button class="btn btn-sm btn-success me-2" onclick="saveItem(${wishlistId}, ${categoryId}, ${itemId})">
                            <i class="fas fa-check me-1"></i>Simpan
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="cancelEditItem(${wishlistId}, ${categoryId}, ${itemId})">
                            <i class="fas fa-times me-1"></i>Batal
                        </button>
                    </div>
                </div>
            `;
      }

      // Handle edit image upload
      function handleEditImageUpload(wishlistId, categoryId, itemId, file) {
        if (!file || !file.type.startsWith("image/")) {
          alert("Silakan pilih file gambar yang valid!");
          return;
        }

        if (file.size > 2 * 1024 * 1024) {
          alert("Ukuran file maksimal 2MB!");
          return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
          const wishlist = wishlists.find((w) => w.id === wishlistId);
          const category = wishlist.categories.find((c) => c.id === categoryId);
          const item = category.items.find((i) => i.id === itemId);

          item.image = e.target.result;
          saveToLocalStorage();
          renderWishlists();
        };
        reader.readAsDataURL(file);
      }

      // Save item changes
      function saveItem(wishlistId, categoryId, itemId) {
        const wishlist = wishlists.find((w) => w.id === wishlistId);
        if (!wishlist) return;

        const category = wishlist.categories.find((c) => c.id === categoryId);
        if (!category) return;

        const item = category.items.find((i) => i.id === itemId);
        if (!item) return;

        const newName = document.getElementById(
          `edit-item-name-${itemId}`
        ).value;
        const newPrice = parseInt(
          document.getElementById(`edit-item-price-${itemId}`).value
        );
        const newTiktokLink = document.getElementById(
          `edit-item-tiktok-${itemId}`
        ).value;
        const newShopeeLink = document.getElementById(
          `edit-item-shopee-${itemId}`
        ).value;
        const newDescription = document.getElementById(
          `edit-item-description-${itemId}`
        ).value;

        if (!newName.trim()) {
          alert("Nama item tidak boleh kosong!");
          return;
        }

        if (!newPrice || newPrice <= 0) {
          alert("Harga item harus diisi dengan angka positif!");
          return;
        }

        item.name = newName;
        item.price = newPrice;
        item.tiktokLink = newTiktokLink;
        item.shopeeLink = newShopeeLink;
        item.description = newDescription;

        saveToLocalStorage();
        renderWishlists();

        // Show success message
        document.getElementById("successMessage").textContent =
          "Item berhasil diupdate!";
        const successModal = new bootstrap.Modal(
          document.getElementById("successModal")
        );
        successModal.show();
      }

      // Cancel edit item
      function cancelEditItem(wishlistId, categoryId, itemId) {
        renderWishlists();
      }

      // Mark item as achieved
      function markItemAchieved(wishlistId, categoryId, itemId) {
        const wishlist = wishlists.find((w) => w.id === wishlistId);
        if (!wishlist) return;

        const category = wishlist.categories.find((c) => c.id === categoryId);
        if (!category) return;

        const item = category.items.find((i) => i.id === itemId);
        if (!item) return;

        item.achieved = !item.achieved;
        saveToLocalStorage();
        renderWishlists();
        updateSavingsDisplay();

        // Show success message
        if (item.achieved) {
          document.getElementById(
            "successMessage"
          ).textContent = `Selamat! Item "${item.name}" berhasil dicapai!`;
          const successModal = new bootstrap.Modal(
            document.getElementById("successModal")
          );
          successModal.show();

          // Add confetti animation
          createConfetti();
        }
      }

      // View photo in modal
      function viewPhoto(photoSrc) {
        document.getElementById("modalPhoto").src = photoSrc;
        const photoModal = new bootstrap.Modal(
          document.getElementById("photoModal")
        );
        photoModal.show();
      }

      // PERBAIKAN: Render wishlists dengan tombol hapus yang berfungsi
      function renderWishlists(filter = "all") {
        let filteredWishlists = wishlists;

        if (filter === "completed") {
          filteredWishlists = wishlists.filter((w) => {
            return (
              w.categories.length > 0 &&
              w.categories.every(
                (c) => c.items.length > 0 && c.items.every((i) => i.achieved)
              )
            );
          });
        } else if (filter === "in-progress") {
          filteredWishlists = wishlists.filter((w) => {
            return w.categories.some((c) => c.items.some((i) => !i.achieved));
          });
        }

        if (filteredWishlists.length === 0) {
          wishlistsContainer.style.display = "none";
          emptyState.style.display = "block";
        } else {
          wishlistsContainer.style.display = "block";
          emptyState.style.display = "none";

          wishlistsContainer.innerHTML = "";

          filteredWishlists.forEach((wishlist, index) => {
            // Calculate totals for this wishlist
            let totalPrice = 0;
            let totalItems = 0;
            let achievedItems = 0;

            wishlist.categories.forEach((category) => {
              category.items.forEach((item) => {
                if (!item.achieved) {
                  totalPrice += item.price;
                }
                totalItems++;
                if (item.achieved) achievedItems++;
              });
            });

            const progressPercentage =
              totalPrice > 0 ? Math.min((savings / totalPrice) * 100, 100) : 0;
            const isCompleted = totalItems > 0 && achievedItems === totalItems;

            const wishlistCard = document.createElement("div");
            wishlistCard.className = "wishlist-card fade-in";
            wishlistCard.style.animationDelay = `${index * 0.1}s`;

            wishlistCard.innerHTML = `
                        <div class="wishlist-header" onclick="toggleCategories(${
                          wishlist.id
                        })">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h4 class="wishlist-title">
                                        <span id="wishlist-title-${
                                          wishlist.id
                                        }">
                                            ${wishlist.name}
                                            <button class="btn btn-sm btn-outline-primary ms-2" onclick="event.stopPropagation(); editWishlistName(${
                                              wishlist.id
                                            })">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </span>
                                        ${
                                          isCompleted
                                            ? '<span class="badge bg-success ms-2"><i class="fas fa-check me-1"></i>Selesai</span>'
                                            : ""
                                        }
                                    </h4>
                                    <p class="wishlist-meta">${
                                      wishlist.categories.length
                                    } kategori, ${totalItems} item</p>
                                </div>
                                <div class="d-flex align-items-center">
                                    <span class="wishlist-price">Rp ${totalPrice.toLocaleString(
                                      "id-ID"
                                    )}</span>
                                    <i id="toggle-icon-${
                                      wishlist.id
                                    }" class="fas fa-chevron-down ms-3"></i>
                                </div>
                            </div>
                        </div>
                        <div class="wishlist-content" id="categories-${
                          wishlist.id
                        }" style="display: none;">
                            ${
                              wishlist.description
                                ? `<p class="mb-3">${wishlist.description}</p>`
                                : ""
                            }
                            
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div class="flex-grow-1 me-3">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <small class="text-muted">Tabungan: Rp ${savings.toLocaleString(
                                          "id-ID"
                                        )} / Rp ${totalPrice.toLocaleString(
              "id-ID"
            )}</small>
                                        <small class="text-muted">${progressPercentage.toFixed(
                                          1
                                        )}%</small>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar ${
                                          isCompleted
                                            ? "bg-success"
                                            : "bg-primary"
                                        }" role="progressbar" style="width: ${progressPercentage}%"></div>
                                    </div>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline-primary me-2" onclick="event.stopPropagation(); openAddCategoryModal(${
                                      wishlist.id
                                    })">
                                        <i class="fas fa-plus me-1"></i>Kategori
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="event.stopPropagation(); deleteWishlist(${
                                      wishlist.id
                                    })">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="categories-list">
                                ${
                                  wishlist.categories.length > 0
                                    ? wishlist.categories
                                        .map((category) => {
                                          let categoryTotalPrice = 0;
                                          let categoryTotalItems = 0;
                                          let categoryAchievedItems = 0;

                                          category.items.forEach((item) => {
                                            if (!item.achieved) {
                                              categoryTotalPrice += item.price;
                                            }
                                            categoryTotalItems++;
                                            if (item.achieved)
                                              categoryAchievedItems++;
                                          });

                                          const categoryProgress =
                                            categoryTotalPrice > 0
                                              ? Math.min(
                                                  (savings /
                                                    categoryTotalPrice) *
                                                    100,
                                                  100
                                                )
                                              : 0;
                                          const categoryCompleted =
                                            categoryTotalItems > 0 &&
                                            categoryAchievedItems ===
                                              categoryTotalItems;

                                          // PERBAIKAN: Gunakan swipe gallery untuk foto kategori
                                          const categoryCoverPhoto =
                                            category.photos &&
                                            category.photos.length > 0
                                              ? category.photos[0]
                                              : null;

                                          return `
                                                    <div class="category-item mb-3 p-3 border rounded">
                                                        <div class="d-flex justify-content-between align-items-center mb-2" onclick="toggleItems(${
                                                          category.id
                                                        })">
                                                            <div class="d-flex align-items-center">
                                                                <!-- Gambar kategori -->
                                                                <div class="me-3">
                                                                    ${
                                                                      categoryCoverPhoto
                                                                        ? `<div class="position-relative">
                                                                                <img src="${categoryCoverPhoto}" class="item-image" onclick="openSwipeGallery(${JSON.stringify(
                                                                            category.photos
                                                                          ).replace(
                                                                            /"/g,
                                                                            "&quot;"
                                                                          )})" alt="${
                                                                            category.name
                                                                          }">
                                                                                ${
                                                                                  category
                                                                                    .photos
                                                                                    .length >
                                                                                  1
                                                                                    ? `<span class="badge bg-primary position-absolute top-0 end-0">+${
                                                                                        category
                                                                                          .photos
                                                                                          .length -
                                                                                        1
                                                                                      }</span>`
                                                                                    : ""
                                                                                }
                                                                            </div>`
                                                                        : `<div class="item-image-placeholder"><i class="fas fa-folder"></i></div>`
                                                                    }
                                                                </div>
                                                                <div>
                                                                    <h5 class="mb-1">
                                                                        <span id="category-title-${
                                                                          category.id
                                                                        }">
                                                                            ${
                                                                              category.name
                                                                            }
                                                                            <button class="btn btn-sm btn-outline-primary ms-2" onclick="event.stopPropagation(); editCategoryName(${
                                                                              wishlist.id
                                                                            }, ${
                                            category.id
                                          })">
                                                                                <i class="fas fa-edit"></i>
                                                                            </button>
                                                                        </span>
                                                                        ${
                                                                          categoryCompleted
                                                                            ? '<span class="badge bg-success ms-2"><i class="fas fa-check me-1"></i>Selesai</span>'
                                                                            : ""
                                                                        }
                                                                    </h5>
                                                                    ${
                                                                      category.description
                                                                        ? `<small class="text-muted">${category.description}</small>`
                                                                        : ""
                                                                    }
                                                                </div>
                                                            </div>
                                                            <div class="d-flex align-items-center">
                                                                <span class="fw-bold">Rp ${categoryTotalPrice.toLocaleString(
                                                                  "id-ID"
                                                                )}</span>
                                                                <i id="item-toggle-icon-${
                                                                  category.id
                                                                }" class="fas fa-chevron-down ms-3"></i>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                                            <div class="flex-grow-1 me-3">
                                                                <div class="d-flex justify-content-between align-items-center mb-1">
                                                                    <small class="text-muted">Tabungan: Rp ${savings.toLocaleString(
                                                                      "id-ID"
                                                                    )} / Rp ${categoryTotalPrice.toLocaleString(
                                            "id-ID"
                                          )}</small>
                                                                    <small class="text-muted">${categoryProgress.toFixed(
                                                                      1
                                                                    )}%</small>
                                                                </div>
                                                                <div class="progress">
                                                                    <div class="progress-bar ${
                                                                      categoryCompleted
                                                                        ? "bg-success"
                                                                        : "bg-info"
                                                                    }" role="progressbar" style="width: ${categoryProgress}%"></div>
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <button class="btn btn-sm btn-outline-primary me-2" onclick="event.stopPropagation(); openAddItemModal(${
                                                                  wishlist.id
                                                                }, ${
                                            category.id
                                          })">
                                                                    <i class="fas fa-plus me-1"></i>Item
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-secondary me-2" onclick="event.stopPropagation(); openCategoryPhotoManagement(${
                                                                  wishlist.id
                                                                }, ${
                                            category.id
                                          })">
                                                                    <i class="fas fa-images me-1"></i>Kelola Foto
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-danger" onclick="event.stopPropagation(); deleteCategory(${
                                                                  wishlist.id
                                                                }, ${
                                            category.id
                                          })">
                                                                    <i class="fas fa-trash"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="items-container" id="items-${
                                                          category.id
                                                        }" style="display: none;">
                                                            <div class="items-list">
                                                                ${
                                                                  category.items
                                                                    .length > 0
                                                                    ? category.items
                                                                        .map(
                                                                          (
                                                                            item
                                                                          ) => {
                                                                            const itemProgress =
                                                                              item.price >
                                                                              0
                                                                                ? Math.min(
                                                                                    (savings /
                                                                                      item.price) *
                                                                                      100,
                                                                                    100
                                                                                  )
                                                                                : 0;

                                                                            return `
                                                                                <div class="item-row p-2 border rounded mb-2" id="item-${
                                                                                  item.id
                                                                                }">
                                                                                    <div class="d-flex align-items-start">
                                                                                        <div class="me-3">
                                                                                            ${
                                                                                              item.image
                                                                                                ? `<img src="${item.image}" class="item-image" onclick="viewPhoto('${item.image}')" alt="${item.name}">`
                                                                                                : `<div class="item-image-placeholder"><i class="fas fa-image"></i></div>`
                                                                                            }
                                                                                        </div>
                                                                                        <div class="flex-grow-1">
                                                                                            <div class="d-flex justify-content-between align-items-center">
                                                                                                <h6 class="mb-1">${
                                                                                                  item.name
                                                                                                } ${
                                                                              item.achieved
                                                                                ? '<span class="badge bg-success ms-2"><i class="fas fa-check me-1"></i>Tercapai</span>'
                                                                                : ""
                                                                            }</h6>
                                                                                                <div>
                                                                                                    <button class="btn btn-sm btn-outline-primary me-2" onclick="editItem(${
                                                                                                      wishlist.id
                                                                                                    }, ${
                                                                              category.id
                                                                            }, ${
                                                                              item.id
                                                                            })">
                                                                                                        <i class="fas fa-edit"></i>
                                                                                                    </button>
                                                                                                    <button class="btn btn-sm ${
                                                                                                      item.achieved
                                                                                                        ? "btn-warning"
                                                                                                        : "btn-success"
                                                                                                    } me-2" onclick="markItemAchieved(${
                                                                              wishlist.id
                                                                            }, ${
                                                                              category.id
                                                                            }, ${
                                                                              item.id
                                                                            })">
                                                                                                        <i class="fas ${
                                                                                                          item.achieved
                                                                                                            ? "fa-undo"
                                                                                                            : "fa-check"
                                                                                                        }"></i>
                                                                                                    </button>
                                                                                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteItem(${
                                                                                                      wishlist.id
                                                                                                    }, ${
                                                                              category.id
                                                                            }, ${
                                                                              item.id
                                                                            })">
                                                                                                        <i class="fas fa-times"></i>
                                                                                                    </button>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                                                <small class="text-muted">Rp ${item.price.toLocaleString(
                                                                                                  "id-ID"
                                                                                                )}</small>
                                                                                                <small class="text-muted">${itemProgress.toFixed(
                                                                                                  1
                                                                                                )}%</small>
                                                                                            </div>
                                                                                            <div class="progress" style="height: 5px;">
                                                                                                <div class="progress-bar" style="width: ${itemProgress}%"></div>
                                                                                            </div>
                                                                                            <div class="mt-1">
                                                                                                ${
                                                                                                  item.tiktokLink
                                                                                                    ? `<a href="${item.tiktokLink}" target="_blank" class="item-link"><i class="fab fa-tiktok me-1"></i>TikTok</a>`
                                                                                                    : ""
                                                                                                }
                                                                                                ${
                                                                                                  item.shopeeLink
                                                                                                    ? `<a href="${item.shopeeLink}" target="_blank" class="item-link"><i class="fas fa-shopping-bag me-1"></i>Shopee</a>`
                                                                                                    : ""
                                                                                                }
                                                                                            </div>
                                                                                            ${
                                                                                              item.description
                                                                                                ? `<div class="mt-1"><small class="text-muted">${item.description}</small></div>`
                                                                                                : ""
                                                                                            }
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            `;
                                                                          }
                                                                        )
                                                                        .join(
                                                                          ""
                                                                        )
                                                                    : `<div class="text-center py-2 text-muted"><small>Belum ada item</small></div>`
                                                                }
                                                            </div>
                                                        </div>
                                                    </div>
                                                `;
                                        })
                                        .join("")
                                    : `<div class="text-center py-3 text-muted"><p>Belum ada kategori</p></div>`
                                }
                            </div>
                        </div>
                    `;

            wishlistsContainer.appendChild(wishlistCard);
          });
        }
      }

      // Filter wishlists
      function filterWishlists(filter) {
        renderWishlists(filter);
      }

      // Render transactions
      function renderTransactions() {
        if (transactions.length === 0) {
          transactionHistory.style.display = "none";
          emptyTransactionState.style.display = "block";
        } else {
          transactionHistory.style.display = "block";
          emptyTransactionState.style.display = "none";

          transactionHistory.innerHTML = "";

          transactions.forEach((transaction) => {
            const transactionItem = document.createElement("div");
            transactionItem.className = "transaction-item";

            const date = new Date(transaction.date);
            const formattedDate = `${date
              .getDate()
              .toString()
              .padStart(2, "0")}/${(date.getMonth() + 1)
              .toString()
              .padStart(2, "0")}/${date.getFullYear()} ${date
              .getHours()
              .toString()
              .padStart(2, "0")}:${date
              .getMinutes()
              .toString()
              .padStart(2, "0")}`;

            transactionItem.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">${transaction.description}</h6>
                                <small class="text-muted">${formattedDate}</small>
                            </div>
                            <div class="text-end">
                                <div class="${
                                  transaction.type === "deposit"
                                    ? "text-success"
                                    : "text-danger"
                                } fw-bold">
                                    ${
                                      transaction.type === "deposit" ? "+" : "-"
                                    } Rp ${transaction.amount.toLocaleString(
              "id-ID"
            )}
                                </div>
                                <small class="text-muted">${
                                  transaction.type === "deposit"
                                    ? "Tabungan"
                                    : "Penarikan"
                                }</small>
                            </div>
                        </div>
                    `;

            transactionHistory.appendChild(transactionItem);
          });
        }
      }

      // Open add category modal
      function openAddCategoryModal(wishlistId) {
        document.getElementById("categoryWishlistId").value = wishlistId;
        const addCategoryModal = new bootstrap.Modal(
          document.getElementById("addCategoryModal")
        );
        addCategoryModal.show();
      }

      // Open add item modal
      function openAddItemModal(wishlistId, categoryId) {
        document.getElementById("itemWishlistId").value = wishlistId;
        document.getElementById("itemCategoryId").value = categoryId;
        const addItemModal = new bootstrap.Modal(
          document.getElementById("addItemModal")
        );
        addItemModal.show();
      }

      // Update statistics
      function updateStats() {
        const totalWishlists = wishlists.length;
        let totalCategories = 0;
        let totalItems = 0;

        wishlists.forEach((wishlist) => {
          totalCategories += wishlist.categories.length;
          wishlist.categories.forEach((category) => {
            totalItems += category.items.length;
          });
        });

        totalWishlistsEl.textContent = totalWishlists;
        totalCategoriesEl.textContent = totalCategories;
        totalItemsEl.textContent = totalItems;
      }

      // Update savings display
      function updateSavingsDisplay() {
        let totalNeeded = 0;
        wishlists.forEach((wishlist) => {
          wishlist.categories.forEach((category) => {
            category.items.forEach((item) => {
              if (!item.achieved) {
                totalNeeded += item.price;
              }
            });
          });
        });

        currentSavingsEl.textContent = `Rp ${savings.toLocaleString("id-ID")}`;
        summaryNeededEl.textContent = `Rp ${totalNeeded.toLocaleString(
          "id-ID"
        )}`;
        summarySavingsEl.textContent = `Rp ${savings.toLocaleString("id-ID")}`;

        const remaining = Math.max(0, totalNeeded - savings);
        summaryRemainingEl.textContent = `Rp ${remaining.toLocaleString(
          "id-ID"
        )}`;

        const progressPercentage =
          totalNeeded > 0 ? Math.min((savings / totalNeeded) * 100, 100) : 0;
        summaryProgressEl.style.width = `${progressPercentage}%`;
        summaryPercentageEl.textContent = `${progressPercentage.toFixed(
          1
        )}% tercapai`;
      }

      // Save to localStorage
      function saveToLocalStorage() {
        localStorage.setItem("wishlists", JSON.stringify(wishlists));
        localStorage.setItem("savings", savings.toString());
        localStorage.setItem("transactions", JSON.stringify(transactions));
      }

      // Create confetti animation
      function createConfetti() {
        const colors = ["#6c5ce7", "#a29bfe", "#fd79a8", "#00b894", "#fdcb6e"];

        for (let i = 0; i < 100; i++) {
          const confetti = document.createElement("div");
          confetti.className = "confetti";
          confetti.style.left = Math.random() * 100 + "vw";
          confetti.style.backgroundColor =
            colors[Math.floor(Math.random() * colors.length)];
          confetti.style.width = Math.random() * 10 + 5 + "px";
          confetti.style.height = Math.random() * 10 + 5 + "px";
          confetti.style.animationDelay = Math.random() * 5 + "s";

          document.body.appendChild(confetti);

          setTimeout(() => {
            confetti.remove();
          }, 5000);
        }
      }
    </script>
  </body>
</html>
